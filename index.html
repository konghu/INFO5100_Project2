<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link rel= "stylesheet" type="text/css" href="styling/map.css">
    <link rel= "stylesheet" type="text/css" href="styling/stylesheet.css">
    <link rel= "stylesheet" type="text/css" href="styling/filter.css">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

</head>
<body onload="wholemap()">

<h1><font face="Monotype Corsiva" size="11" color="#800000">20 Interesting Dance Styles</font></h1>
<div class="map">
    <nav id="primary_nav_wrap">
        <ul>
            <li class="current-menu-item"><a href="#" onclick="wholemap()">Home</a></li>
            <li><a href="#">Dance Style</a>
                <ul>
					<li><a href="#" onclick="solo()">Solo</a></li>
                    <li><a href="#">Couple</a></li>
                    <li><a href="#">Group</a></li>                    
                </ul>
            </li>
            <li><a href="#">Dance Categories</a>
                <ul>
                    <li><a href="#">Ballroom</a></li>
                    <li><a href="#">Folk</a></li>
                    <li><a href="#">Ceremonial</a></li>
					<li><a href="#">Street</a></li>
					<li><a href="#">Concert</a></li>
                </ul>
            </li>
            <li><a href="#">Menu 3</a>
                <ul>
                    <li class="dir"><a href="#">Sub Menu 1</a></li>
                    <li class="dir"><a href="#">Sub Menu 2 THIS IS SO LONG IT MIGHT CAUSE AN ISSEUE BUT MAYBE NOT?</a>
                        <ul>
                            <li><a href="#">Category 1</a></li>
                            <li><a href="#">Category 2</a></li>
                            <li><a href="#">Category 3</a></li>
                            <li><a href="#">Category 4</a></li>
                            <li><a href="#">Category 5</a></li>
                        </ul>
                    </li>
                    <li><a href="#">Sub Menu 3</a></li>
                    <li><a href="#">Sub Menu 4</a></li>
                    <li><a href="#">Sub Menu 5</a></li>
                </ul>
            </li>
            <li><a href="#">Contact Us</a></li>
        </ul>
    </nav>

</div>

<div id = "right">
    <div id = "info">
       <p id = "description"></p>

    </div>

    <div class = videos>

        <div class="popup" id="media-popup">
            <iframe width="390" height="250" src="" frameborder="0" allowfullscreen id="videoTag"></iframe>
        </div>
    </div>
</div>
<div id = "filter">

</div>


<script>
var mapDiv = d3.select('.map');
var width = 1380;
var height = 0.35 * width;
var plotCenter = [ width/2, height/2 ];
var initialLongitude = -95;            // Initial longitude to center
var latitudeBounds = [ -80, 84 ];      // Maximum latitude to display

var projection = d3.geo.mercator().rotate([-initialLongitude, 0])    // Rotate the initial longitude to center
								  .scale(1)                          // We'll scale up to match the viewport shortly
								  .translate(plotCenter)
								  .center([0, 10]);

var viewMin = [ 0, 0 ];
var viewMax = [ 0, 0 ];
// The following variables track the last processed event.
var translateLast = [0,0];
var scaleLast     = null;

var marks = []; //Longitude and latitude
var danceInfo = [];
var countryId = [];
var danceDescription = [];
var videoUrl = [];

var path,svg,map;

var solomarks = [];
var solodanceInfo = [];
function wholemap()
{
			function updateProjectionBounds () {
				// Updates the view top left and bottom right with the current projection.
				var yaw = projection.rotate()[0];
				var longitudeHalfRotation = 180.0 - 1e-6;

				viewMin = projection([-yaw - longitudeHalfRotation, latitudeBounds[1]]);
				viewMax = projection([-yaw + longitudeHalfRotation, latitudeBounds[0]]);
			}

			updateProjectionBounds();

			// Set up the scale extent and initial scale for the projection.
			var s = width / (viewMax[0] - viewMin[0]);
			var scaleExtent = [s, 50*s];        // The minimum and maximum zoom scales

			projection.scale(scaleExtent[0]);         // Set up projection to minimium zoom

			path = d3.geo.path().projection(projection);

			svg = mapDiv.append('svg')      // Set up map SVG element
				.attr('id', "map")
				.attr('width',width)
				.attr('height',height);

			map = svg.append('g');          // Map Group

			svg.append("rect")
				.attr("class", "overlay")
				.attr("width", width)
				.attr("height", height);

			var zoom = d3.behavior.zoom()       // Set up zoom
				.size([width,height])
				.scaleExtent(scaleExtent)
				.scale(projection.scale())
				.on("zoom", handlePanZoom);

			svg.call(zoom);                     // Attach zoom event

			// Load map data
			d3.json("data/world-110m.json", function (error, world) {

				map.selectAll('path')
					.data(topojson.feature(world, world.objects.countries).features)
					.enter()
					.append('path');

				render();
			});

			

			d3.json("data/danceform.json", function(error, d){

				for(var i in d) {

					var item = d[i];

					marks.push({
						"lat" : item.Latitude,
						"long"  : item.Longitude
					});

					danceInfo.push({
						"id": item.Country,
						"description": item.Description
					});
					countryId.push(item.Country);
					danceDescription.push(item.Description);
					videoUrl.push(item.Video);
				}

				render();
			});
			
			d3.json("data/danceform.json", function(error, d){

				for(var i in d) {

					var item = d[i];
					if( (item.Participation=="Solo") || (item.Participation=="Solo,Group") )
					{
						solomarks.push({
							"lat" : item.Latitude,
							"long"  : item.Longitude
						});
						solodanceInfo.push({
						"id": item.Country,
						"description": item.Description
						});						
					}
				}
			});
			
			function render() {
				map.selectAll('path')       // Redraw all map paths
					.attr('d', path);

				d3.selectAll("image")
					.remove();


				var circles = svg.append("g")
					.attr("class", "group");


				circles.selectAll("image")
					.data(marks)
					.enter()
					.append("image")

					.attr("xlink:href","images/icon.png ")
					.attr("class", "icons")
					.attr("id", function (d, i) {
						return danceInfo[i].id
					})
					.attr("height", 25)
					.attr("width", 25)
					.attr("x", function(d) {
						return projection([d.long, d.lat])[0] -15;
					})
					.attr("y", function(d) {
						return projection([d.long, d.lat])[1] -15;
					})
					.attr("r", 5)
					.on('click', function(d){
						document.getElementById("map").setAttribute("width", "900px");
						document.getElementById("map").setAttribute("height", "400px");


						var description = document.createTextNode(danceDescription[countryId.indexOf(this.id)]);
						$("#description").html("");
						$("#description").html(description);
						updateVideo(this.id);
					})
			}

			function updateVideo(id) {
				document.getElementById("right").style.display = "block";
				document.getElementById("videoTag").src = videoUrl[countryId.indexOf(id)];

			}

			function handlePanZoom() {
				// Handle pan and zoom events

				var scale = zoom.scale();
				var translate = zoom.translate();

				// If the scaling changes, ignore translation (otherwise touch zooms are weird).
				var delta = [ translate[0] - translateLast[0], translate[1] - translateLast[1] ];
				if (scale != scaleLast) {
					projection.scale(scale);
				} else {
					var longitude = projection.rotate()[0];
					var tp = projection.translate();

					// Use the X translation to rotate, based on the current scale.
					longitude += 360 * (delta[0] / width) * (scaleExtent[0] / scale);
					projection.rotate ([longitude, 0, 0]);

					// Use the Y translation to translate projection, clamped by min/max
					updateProjectionBounds();

					if (viewMin[1] + delta[1] > 0)
						delta[1] = -viewMin[1];
					else if (viewMax[1] + delta[1] < height)
						delta[1] = height - viewMax[1];

					projection.translate ([ tp[0], tp[1] + delta[1] ]);
				}

				// Store the last transform values. NOTE: Resetting zoom.translate() and zoom.scale()
				// would seem equivalent, but it doesn't seem to work reliably.
				scaleLast = scale;
				translateLast = translate;

				render();
			}
}
function solo()
{
	d3.selectAll("image").remove();		
    var circles = svg.append("g")
        .attr("class", "group");

    circles.selectAll("image")
        .data(solomarks)
        .enter()
        .append("image")
        .attr("xlink:href","images/icon.png ")
        .attr("class", "icons")
        .attr("id", function (d, i) {
            return solodanceInfo[i].id
        })
        .attr("height", 25)
        .attr("width", 25)
        .attr("x", function(d) {
            return projection([d.long, d.lat])[0] -15;
        })
        .attr("y", function(d) {
            return projection([d.long, d.lat])[1] -15;
        })
        .attr("r", 5)
        .on('click', function(d){
            document.getElementById("map").setAttribute("width", "900px");
            document.getElementById("map").setAttribute("height", "400px");
			var description = document.createTextNode(danceDescription[countryId.indexOf(this.id)]);
						$("#description").html("");
						$("#description").html(description);
						updateVideo(this.id);

		});
	marks = solomarks;
	danceInfo = solodanceInfo;	
}
</script>
<script src="js/videos.js"></script>
